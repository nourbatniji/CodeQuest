{% extends 'base.html' %}
{% for challenge in challenges %}
{% block title %}{{ challenge.title }} Problem - CodeQuest{% endblock %}
{% endfor %}
{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
<link rel="stylesheet" href="{% static 'css/challenge_details.css' %}">
<style>
    .challenge-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .problem-section,
    .editor-section {
        background: var(--surface);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        border: 1px solid var(--border-color);
    }

    .code-editor {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 1rem;
        font-family: 'JetBrains Mono', monospace;
        min-height: 400px;
        resize: vertical;
        width: 100%;
        color: var(--text-primary);
        font-size: 0.875rem;
    }

    .code-editor:focus {
        outline: none;
        border-color: var(--primary-500);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .test-case {
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 3px solid var(--primary-500);
    }

    .submission-item {
        background: var(--surface);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .comment-box {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 1rem;
        margin-bottom: 1rem;
    }

    @media (max-width: 1024px) {
        .challenge-container {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Challenge Header -->
<div class="dashboard-header animate-fade-in">
    <div style="display: flex; justify-content: space-between; align-items: start;">
        <div>
            <h1><i class="fas fa-code"></i> {{challenge.title}}</h1>
            
        </div>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
            <span class="badge-modern badge-easy">
                <i class="fas fa-circle"></i> {{challenge.difficulty}}
            </span>
            <a href="/classrooms/" class="btn-modern btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Classroom
            </a>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="challenge-container animate-fade-in">
    <!-- Problem Description -->
    <div class="problem-section">
        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">
            <i class="fas fa-book"></i> Problem Description
        </h3>
        <p class="text-black">{{challenge.description}}</p>
        <p class="m-0"><span class="text-black">Input description:</span> {{challenge.input_description}}</p>
        <p><span class="text-black">Output description:</span> {{challenge.output_description}}</p>

        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: var(--text-primary);">
            <i class="fas fa-lightbulb"></i> Example
        </h4>

        <div class="test-case">
            <strong style="color: var(--text-primary);">Input:</strong>
            <pre style="margin: 0.5rem 0; color: var(--text-secondary);">{{challenge.sample_input}}</pre>
            <strong style="color: var(--text-primary);">Output:</strong>
            <pre style="margin: 0.5rem 0; color: var(--text-secondary);">{{challenge.sample_output}}</pre>
            <strong style="color: var(--text-primary);">Explanation:</strong>
            <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">
                {{challenge.example_explanation}}
            </p>
        </div>

        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: var(--text-primary);">
            <i class="fas fa-list"></i> Constraints
        </h4>
        <ul style="color: var(--text-secondary); padding-left: 1.5rem;">
            {% for line in challenge.constraints.splitlines %}
            {% if line %}
            <li>{{ line }}</li>
            {% endif %}
            {% endfor %}
        </ul>

        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: var(--text-primary);">
            <i class="fas fa-tags"></i> Tags
        </h4>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            {% for tag in challenge.tags.all %}
            <span class="badge-modern badge-primary">{{ tag.name }}</span>
            {% empty %}
            <span class="text-muted">No tags</span>
            {% endfor %}
        </div>
    </div>

    <!-- Code Editor -->
    <div class="editor-section" id="challenge-data" data-slug="{{ challenge.slug }}">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0; color: var(--text-primary);">
                <i class="fas fa-terminal"></i> Code Editor
            </h3>
            <select class="filter-select" style="width: auto; min-width: 150px;">
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="java">Java</option>
                <option value="cpp">C++</option>
            </select>
        </div>

        <form method="POST" action="/challenge/1/submit/">
            {% csrf_token %}
            <textarea id="code-editor" class="code-editor" name="code" placeholder="Write your solution here..."
            spellcheck="false">{{ challenge.starter_code }}
            </textarea>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button id="submit-btn" type="submit" class="btn-modern btn-primary" style="flex: 1;">
                    <i class="fas fa-paper-plane"></i>
                    <span class="btn-text">Submit Solution</span>
                    <span class="spinner" style="display:none;"></span>
                </button>
                <button type="button" class="btn-modern btn-secondary" onclick="runTests(this)">
                    <i class="fas fa-play"></i> Run Tests
                    <span class="spinner" style="display:none;"></span>
                </button>
                <!-- Result -->
                <div id="submission-result"></div>
            </div>
        </form>

        <div style="margin-top: 1.5rem;">
            <h4 style="margin-bottom: 1rem; color: var(--text-primary);">
                <i class="fas fa-vial"></i> Test Results
            </h4>
            <div id="test-results" style="color: var(--text-secondary); font-size: 0.875rem;">
                <p style="text-align: center; padding: 2rem; color: var(--text-tertiary);">
                    <i class="fas fa-info-circle"></i> Run tests to see results
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Submission History -->
<div class="section-header">
    <h2><i class="fas fa-history"></i> Your Submissions</h2>
</div>
<!-- Submissions List -->
 
<div class="animate-fade-in" style="margin-bottom: 2rem;"  id="submission-list">
    {% for submission in submissions %}
    <div class="submission-item" data-id="{{ submission.id }}">
    <div>
        <div class="submission-header" style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">
            Submission #{{ submission.id }}
        </div>
        <div style="font-size: 0.875rem; color: var(--text-secondary);">
            <i class="fas fa-clock"></i>{{ submission.created_at|timesince }} ago
        </div>
    </div>
     <!-- submission code -->
    <pre class="submission-code"><code class="language-python">{{ submission.code }}</code></pre>
    <div style="display: flex; gap: 1rem; align-items: right;">
        <span class="badge-modern" style="background-color: rgba(16, 185, 129, 0.1); color: var(--success);">
            <i class="fas fa-check-circle"></i> {{ submission.status }}
        </span>
        <button class="view-code-btn btn-modern btn-secondary" style="padding: 0.5rem 1rem;">
            <i class="fas fa-eye"></i> View Code
        </button>
    </div>
</div>

    {% empty %}
    <div  id="no-submissions" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
        No submissions yet
    </div>
{% endfor %}
</div>

<!-- Discussions -->
<div class="section-header">
    <h2><i class="fas fa-comments"></i> Discussions</h2>
</div>
<div class="animate-fade-in">
    <!-- Comment Form -->
    <div class="card-modern" style="margin-bottom: 1.5rem;">
        <h4 style="margin-bottom: 1rem; color: var(--text-primary);">
            <i class="fas fa-comment-dots"></i> Add a Comment
        </h4>
        <form id="comment-form"  data-slug="{{ challenge.slug }}">
            {% csrf_token %}
            <textarea class="form-control-modern" name="comment" rows="3"
                placeholder="Ask a question or share a hint..." style="width: 100%; margin-bottom: 1rem;"></textarea>
            <button type="submit" class="btn-modern btn-primary">
                <i class="fas fa-paper-plane"></i> Post Comment
            </button>
        </form>
    </div>
</div>

<!-- Comments List -->
 
 <div id="comment-list">
    <h3>Comments</h3>
        <!-- Container where AJAX will inject comments -->
        <div id="comments-container" class="comments-list"></div>
        <!-- Pagination Controls -->
    <div id="pagination-controls" style="margin-top: 1rem;">
        <button id="prev-page" class="btn-modern btn-secondary" disabled>Previous</button>
        <button id="next-page" class="btn-modern btn-secondary" disabled>Next</button>
    </div>
</div>


<!-- Hidden Tests Data -->
{{ challenge.hidden_tests|json_script:"hidden-tests-data" }}
{% endblock %}
{% block scripts %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="{% static 'js/challenge_details.js' %}"></script>
{% endblock %}