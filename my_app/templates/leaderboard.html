{% extends 'base.html' %}

{% block title %}Leaderboard - CodeQuest{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
{% endblock %}

{% block content %}

<!-- Header -->
<div class="leaderboard-header animate-fade-in">
    <h1><i class="fas fa-trophy"></i> Global Leaderboard</h1>
    <p style="color: var(--text-secondary); font-size: 1.125rem;">
        Compete with coders worldwide
    </p>
</div>

<!-- My Rank Card -->
<div class="my-rank-card animate-fade-in">
    <div class="my-rank-info">
        <h3>Your Current Rank</h3>
        <p>You're doing great! Keep solving challenges to climb higher.</p>
    </div>

    <div class="my-rank-stats">
        <div class="my-rank-stat">
            <div class="my-rank-stat-value">#{{ user_rank|default:"-" }}</div>
            <div class="my-rank-stat-label">Global Rank</div>
        </div>

        <div class="my-rank-stat">
            <div class="my-rank-stat-value">{{ user_points|default:"0" }}</div>
            <div class="my-rank-stat-label">Total Points</div>
        </div>

        <div class="my-rank-stat">
            <div class="my-rank-stat-value">+0</div>
            <div class="my-rank-stat-label">This Week</div>
        </div>
    </div>
</div>

<!-- Filters -->
<form method="get">
    <div class="leaderboard-filters animate-fade-in">
        <div class="filter-row">

            <!-- Time Filter -->
            <div class="filter-group">
                <label class="filter-label">Time Range</label>
                <select class="filter-select" name="time" onchange="this.form.submit()">
                    <option value="all" {% if selected_time == 'all' %}selected{% endif %}>All Time</option>
                    <option value="week" {% if selected_time == 'week' %}selected{% endif %}>This Week</option>
                    <option value="month" {% if selected_time == 'month' %}selected{% endif %}>This Month</option>
                </select>
            </div>

            <!-- Classroom Filter -->
            <div class="filter-group">
                <label class="filter-label">Classroom</label>
                <select class="filter-select" name="classroom" onchange="this.form.submit()">
                    <option value="all">All Classrooms</option>
                    {% for classroom in classrooms %}
                        <option value="{{ classroom.id }}" 
                            {% if selected_classroom == classroom.id %}selected{% endif %}
                        >
                            {{ classroom.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Sort Filter -->
            <div class="filter-group">
                <label class="filter-label">Sort By</label>
                <select class="filter-select" name="sort" onchange="this.form.submit()">
                    <option value="points" {% if selected_sort == 'points' %}selected{% endif %}>Points</option>
                    <option value="challenges" {% if selected_sort == 'challenges' %}selected{% endif %}>Challenges Solved</option>
                    <option value="streak" {% if selected_sort == 'streak' %}selected{% endif %}>Streak</option>
                </select>
            </div>

        </div>
    </div>
</form>

<!-- Top Performers -->
<div class="section-header">
    <h2>Top Performers</h2>
</div>

<div class="top-performers animate-fade-in">
    {% for profile in leaderboard|slice:":3" %}

        {% if forloop.first %}
            <div class="top-performer-card gold">
        {% elif forloop.counter == 2 %}
            <div class="top-performer-card silver">
        {% else %}
            <div class="top-performer-card bronze">
        {% endif %}

            <div class="performer-name">{{ profile.user.username }}</div>
            <div class="user-level">{{ profile.level }}</div>

            <div class="performer-stats">
                <div class="performer-stat">
                    <div class="performer-stat-value">{{ profile.total_points }}</div>
                    <div class="performer-stat-label">Points</div>
                </div>
                <div class="performer-stat">
                    <div class="performer-stat-value">{{ profile.solved_count }}</div>
                    <div class="performer-stat-label">Solved</div>
                </div>
            </div>
        </div>

    {% endfor %}
</div>

<!-- Full Leaderboard -->
<div class="section-header" style="margin-top: 2rem;">
    <h2>Rankings</h2>
</div>

<div class="leaderboard-table-container animate-fade-in">
    <table class="leaderboard-table">

        <thead>
            <tr>
                <th>Rank</th>
                <th>User</th>
                <th>Points</th>
                <th>Solved</th>
                <th>Badges</th>
                <th>Streak</th>
            </tr>
        </thead>

        <tbody>
            {% for profile in leaderboard %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ profile.user.username }}</td>
                    <td>{{ profile.total_points }}</td>
                    <td>{{ profile.solved_count }}</td>
                    <td>{{ profile.badges_count }}</td>
                    <td>{{ profile.streak|default:"-" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6">No users yet</td>
                </tr>
            {% endfor %}
        </tbody>

    </table>
</div>

{% endblock %}
