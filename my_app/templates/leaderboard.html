{% extends 'base.html' %}

{% block title %}Leaderboard - CodeQuest{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
{% endblock %}

{% block content %}

<!-- Header -->
<div class="leaderboard-header animate-fade-in">
    <h1><i class="fas fa-trophy"></i> Global Leaderboard</h1>
    <p style="color: var(--text-secondary); font-size: 1.125rem;">
        Compete with coders worldwide
    </p>
</div>

<!-- My Rank Card -->
<div class="my-rank-card animate-fade-in">
    <div class="my-rank-info">
        <h3>Your Current Rank</h3>
        <p>You're doing great! Keep solving challenges to climb higher.</p>
    </div>

    <div class="my-rank-stats">
        <div class="my-rank-stat">
            <div class="my-rank-stat-value">#{{ user_rank|default:"-" }}</div>
            <div class="my-rank-stat-label">Global Rank</div>
        </div>

        <div class="my-rank-stat">
            <div class="my-rank-stat-value">{{ user_points|default:"0" }}</div>
            <div class="my-rank-stat-label">Total Points</div>
        </div>

        <div class="my-rank-stat">
            <div class="my-rank-stat-value">+0</div>
            <div class="my-rank-stat-label">This Week</div>
        </div>
    </div>
</div>

<!-- Filters -->
<form method="get">
    <div class="leaderboard-filters animate-fade-in">
        <div class="filter-row">

            <!-- Time Filter -->
            <div class="filter-group">
                <label class="filter-label">Time Range</label>
                <select class="filter-select" name="time" onchange="this.form.submit()">
                    <option value="all" {% if selected_time == 'all' %}selected{% endif %}>All Time</option>
                    <option value="week" {% if selected_time == 'week' %}selected{% endif %}>This Week</option>
                    <option value="month" {% if selected_time == 'month' %}selected{% endif %}>This Month</option>
                </select>
            </div>

            <!-- Classroom Filter -->
            <div class="filter-group">
                <label class="filter-label">Classroom</label>
                <select class="filter-select" name="classroom" onchange="this.form.submit()">
                    <option value="all">All Classrooms</option>
                    {% for classroom in classrooms %}
                    <option value="{{ classroom.id }}" {% if selected_classroom == classroom.id %}selected{% endif %}>
                        {{ classroom.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Sort Filter -->
            <div class="filter-group">
                <label class="filter-label">Sort By</label>
                <select class="filter-select" name="sort" onchange="this.form.submit()">
                    <option value="points" {% if selected_sort == 'points' %}selected{% endif %}>Points</option>
                    <option value="challenges" {% if selected_sort == 'challenges' %}selected{% endif %}>Challenges Solved
                    </option>
                    <option value="streak" {% if selected_sort == 'streak' %}selected{% endif %}>Streak</option>
                </select>
            </div>

        </div>
    </div>
</form>

<!-- Top Performers -->
<div class="section-header">
    <h2><i class="fas fa-star"></i> Top Performers</h2>
</div>

<div class="top-performers animate-fade-in">
    {% for profile in leaderboard|slice:":3" %}

    {% if forloop.first %}
    <div class="top-performer-card gold">
        <div class="performer-rank" style="color: #fbbf24;">
            <i class="fas fa-crown"></i>
        </div>
        {% elif forloop.counter  ==  2 %}
        <div class="top-performer-card silver">
            <div class="performer-rank" style="color: #94a3b8;">
                <i class="fas fa-medal"></i>
            </div>
            {% else %}
            <div class="top-performer-card bronze">
                <div class="performer-rank" style="color: #f97316;">
                    <i class="fas fa-medal"></i>
                </div>
                {% endif %}

                <div class="performer-avatar"
                    style="background: linear-gradient(135deg, 
                {% if forloop.first %}#fbbf24, #f59e0b{% elif forloop.counter  ==  2 %}#94a3b8, #64748b{% else %}#f97316, #ea580c{% endif %}); 
                display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 700;">
                    {{ profile.user.username|first|upper }}
                </div>

                <div class="performer-name">{{ profile.user.username }}</div>
                <div class="user-level">Level {{ profile.level|default:"1" }}</div>

                <div class="performer-stats">
                    <div class="performer-stat">
                        <div class="performer-stat-value">{{ profile.total_points|default:0 }}</div>
                        <div class="performer-stat-label">Points</div>
                    </div>
                    <div class="performer-stat">
                        <div class="performer-stat-value">{{ profile.solved_count|default:0 }}</div>
                        <div class="performer-stat-label">Solved</div>
                    </div>
                </div>
            </div>

            {% empty %}
            <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--text-secondary);">
                <i class="fas fa-trophy"
                    style="font-size: 4rem; margin-bottom: 1rem; color: var(--text-tertiary); display: block;"></i>
                <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">No Top Performers Yet</h3>
                <p>Start solving challenges to claim the top spot!</p>
            </div>
            {% endfor %}
        </div>

        <!-- Full Leaderboard -->
        <div class="section-header" style="margin-top: 2rem;">
            <h2>Rankings</h2>
        </div>

        <div class="leaderboard-table-container animate-fade-in">
            <table class="leaderboard-table">

                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>User</th>
                        <th>Points</th>
                        <th>Solved</th>
                        <th>Badges</th>
                        <th>Streak</th>
                    </tr>
                </thead>

                <tbody>
                    {% for profile in leaderboard %}
                    <tr {% if profile.user == user %}class="current-user" {% endif %}>
                        <td class="rank-cell {% if forloop.counter <= 3 %}top-3{% endif %}">
                            {% if forloop.counter  ==  1 %}
                            <i class="fas fa-crown" style="color: #fbbf24; margin-right: 0.5rem;"></i>
                            {% elif forloop.counter  ==  2 %}
                            <i class="fas fa-medal" style="color: #94a3b8; margin-right: 0.5rem;"></i>
                            {% elif forloop.counter  ==  3 %}
                            <i class="fas fa-medal" style="color: #f97316; margin-right: 0.5rem;"></i>
                            {% endif %}
                            {{ forloop.counter }}
                        </td>
                        <td>
                            <div class="user-cell">
                              
                                <div class="user-info">
                                    <div class="user-name">{{ profile.user.username }}</div>
                                    <div class="user-level">Level {{ profile.level|default:"1" }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="points-cell">{{ profile.total_points|default:0 }}</td>
                        <td>{{ profile.solved_count|default:0 }}</td>
                        <td>
                            {% if profile.badges_count > 0 %}
                            <span class="badge-modern badge-primary">
                                <i class="fas fa-award"></i> {{ profile.badges_count }}
                            </span>
                            {% else %}
                            <span style="color: var(--text-tertiary);">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if profile.streak > 0 %}
                            <span style="color: var(--warning); font-weight: 600;">
                                <i class="fas fa-fire"></i> {{ profile.streak }}
                            </span>
                            {% else %}
                            <span style="color: var(--text-tertiary);">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <i class="fas fa-users"
                                style="font-size: 3rem; margin-bottom: 1rem; color: var(--text-tertiary); display: block;"></i>
                            No users on the leaderboard yet. Be the first to solve challenges!
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                </tbody>

            </table>
        </div>

        {% endblock %}




        