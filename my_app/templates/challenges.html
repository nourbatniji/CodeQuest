{% extends 'base.html' %}

{% block title %}Challenges - CodeQuest{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="dashboard-header animate-fade-in">
    <h1><i class="fas fa-code"></i> Browse Challenges</h1>
    <p>Explore coding challenges across all classrooms</p>
</div>

<!-- Filters -->
<div class="leaderboard-filters animate-fade-in">
    <form method="get" class="filter-row">
        <div class="filter-group" style="flex: 2;">
            <label class="filter-label">Search Challenges</label>
            <input type="text" class="form-control-modern" placeholder="Search by title or tags..." name="search"
                value="{{ request.GET.search }}" id="searchChallenges">
        </div>

        <!-- Difficulty filter -->
        <div class="filter-group">
            <label class="filter-label">Difficulty</label>
            <select class="filter-select" name="difficulty" onchange="this.form.submit()">
                <option value="all">All Levels</option>
                <option value="easy" {% if selected_difficulty == "easy" %}selected{% endif %}>Easy</option>
                <option value="medium" {% if selected_difficulty == "medium" %}selected{% endif %}>Medium</option>
                <option value="hard" {% if selected_difficulty == "hard" %}selected{% endif %}>Hard</option>
            </select>
        </div>

        <!-- Classroom filter -->
        <div class="filter-group">
            <label class="filter-label">Classroom</label>
            <select class="filter-select" name="classroom" onchange="this.form.submit()">
                <option value="">All Classrooms</option>
                {% for c in classrooms %}
                <option value="{{ c.id }}" 
                {% if selected_classroom|stringformat:"s" == c.id|stringformat:"s" %}selected{% endif %}>
                    {{ c.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Tag filter -->
        <div class="filter-group">
            <label class="filter-label">Tags</label>
            <select class="filter-select" name="tag" onchange="this.form.submit()">
                <option value="">All Tags</option>
                {% for t in tags %}
                <option value="{{ t.id }}" {% if selected_tag|stringformat:"s" == t.id|stringformat:"s" %}selected{% endif %}>
                    {{ t.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Optional status filter (UI only for now) -->
        <div class="filter-group">
            <label class="filter-label">Status</label>
            <select class="filter-select" name="status">
                <option value="">All Challenges</option>
                <option value="not_started">Not Started</option>
                <option value="in_progress">In Progress</option>
                <option value="completed">Completed</option>
            </select>
        </div>

        <div class="filter-group" style="align-self: flex-end;">
            <button type="submit" class="btn-modern btn-primary">Apply</button>
        </div>
    </form>
</div>

<!-- Challenges List -->
<div class="challenge-list animate-fade-in">
    {% for challenge in challenges %}
    <div class="challenge-item" onclick="window.location.href='/challenge/{{ challenge.slug }}/'">
        <div class="challenge-info">
            <div class="challenge-title">{{ challenge.title }}</div>
            <div class="challenge-meta">
                <span class="badge-modern badge-easy">
                    <i class="fas fa-circle"></i> {{ challenge.difficulty }}
                </span>
                <span style="color: var(--text-secondary); font-size: 0.875rem;">
                    <i class="fas fa-folder"></i> {{ challenge.classroom.name }}
                </span>
                <span style="color: var(--text-secondary); font-size: 0.875rem;">
                    <i class="fas fa-tags"></i>
                    {% for tag in challenge.tags.all %}
                    {{ tag.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                    No tags
                    {% endfor %}
                </span>
            </div>
        </div>
        <div class="challenge-actions">
            <span style="color: var(--text-secondary); font-size: 0.875rem;">
                <i class="fas fa-users"></i> {{ challenge.solved_count }}
            </span>
            <button class="btn-modern btn-primary">
                <i class="fas fa-play"></i> Start
            </button>
        </div>
    </div>
    {% empty %}
    <p>No challenges found.</p>
    {% endfor %}
</div>

{% endblock %}