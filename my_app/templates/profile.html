{% extends 'base.html' %}

{% block title %}{{ profile_user.username }}'s Profile - CodeQuest{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/leaderboard.css' %}">
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block content %}

<!-- Profile Header -->
<div class="profile-header animate-fade-in">
    <div class="profile-header-content">
        <div class="profile-avatar-large">
            {% if profile_user.profile.avatar %}
            <img src="{{ profile_user.profile.avatar.url }}" alt="{{ profile_user.username }}">
            {% else %}
            <div class="avatar-placeholder">
                {{ profile_user.username|first|upper }}
            </div>
            {% endif %}
        </div>

        <div class="profile-info">
            <h1>{{ profile_user.username }}</h1>
            <p class="profile-bio">{{ profile_user.profile.bio|default:"No bio added yet." }}</p>

            <div class="profile-meta">
                <div class="profile-meta-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Joined {{ profile_user.date_joined|date:"M Y" }}</span>
                </div>
                {% if profile_user.profile.location %}
                <div class="profile-meta-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>{{ profile_user.profile.location }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        {% if user == profile_user %}
        <div class="profile-actions">
            <a href="" class="btn-modern btn-secondary">
                <i class="fas fa-edit"></i> Edit Profile
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid animate-fade-in">
    <div class="stat-card">
        <div class="stat-card-icon primary">
            <i class="fas fa-trophy"></i>
        </div>
<div class="stat-card-value">{{ total_points|default:0 }}</div>
        <div class="stat-card-label">Total Points</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon success">
            <i class="fas fa-check-circle"></i>
        </div>
<div class="stat-card-value">{{ solved_count|default:0 }}</div>
        <div class="stat-card-label">Challenges Solved</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon warning">
            <i class="fas fa-fire"></i>
        </div>
        <div class="stat-card-value">{{ profile_user.profile.streak|default:0 }}</div>
        <div class="stat-card-label">Day Streak</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-icon info">
            <i class="fas fa-medal"></i>
        </div>
        <div class="stat-card-value">{{ profile_user.profile.badges_count|default:0 }}</div>
        <div class="stat-card-label">Badges Earned</div>
    </div>
</div>

<!-- Recent Activity & Achievements -->
<div class="profile-content-grid animate-fade-in">

    <!-- Recent Activity -->
    <div class="profile-section">
        <div class="section-header">
            <h2><i class="fas fa-history"></i> Recent Activity</h2>
        </div>

        <div class="activity-list">
            {% for submission in recent_submissions %}
            <div class="activity-item">
                <div class="activity-icon {% if submission.status == 'passed' %}success{% else %}error{% endif %}">
                    <i class="fas {% if submission.status == 'passed' %}fa-check{% else %}fa-times{% endif %}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">{{ submission.challenge.title }}</div>
                    <div class="activity-time">{{ submission.created_at|timesince }} ago</div>
                </div>
                <span
                    class="badge-modern {% if submission.status == 'passed' %}badge-passed{% else %}badge-failed{% endif %}">
                    {{ submission.status|title }}
                </span>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-inbox"></i>
                </div>
                <p>No recent activity</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Achievements/Badges -->
    <div class="profile-section">
        <div class="section-header">
            <h2><i class="fas fa-award"></i> Achievements</h2>
        </div>

        <div class="badges-grid">
            {% for badge in badges %}
            <div class="badge-card">
                <div class="badge-icon">
                    <i class="{{ badge.icon }}"></i>
                </div>
                <div class="badge-name">{{ badge.name }}</div>
                <div class="badge-description">{{ badge.description }}</div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-medal"></i>
                </div>
                <p>No badges earned yet</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Skills & Progress -->
<div class="section-header" style="margin-top: 2rem;">
    <h2><i class="fas fa-chart-bar"></i> Skills</h2>
</div>

{% if skills %}
<div class="skills-grid animate-fade-in">
    {% for skill in skills %}
    <div class="skill-card">
        <div class="skill-header">
            <span class="skill-name">{{ skill.name }}</span>
            <span class="skill-percentage">{{ skill.percentage }}%</span>
        </div>
        <div class="progress-modern">
            <div class="progress-bar-modern" style="width: {{ skill.percentage }}%;"></div>
        </div>
        <div class="skill-meta">
            {{ skill.solved_count }} challenges solved
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-state-icon">
        <i class="fas fa-chart-bar"></i>
    </div>
    <p>No skills data yet. Solve some challenges to build your stats!</p>
</div>
{% endif %}


{% endblock %}



